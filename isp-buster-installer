#!/bin/bash

# General Directory Declarations
START_DIR=$PWD
INSTALL_DIR=/etc/isp-buster
RESULTS_DIR="${INSTALL_DIR}/results"
LOGS_DIR="${INSTALL_DIR}/logs"
BAK_DIR="${INSTALL_DIR}/backup"
CLONE_DIR="${INSTALL_DIR}/isp-buster"
SCRIPTS_DIR=/usr/bin/

# Filename Declarations
MY_PATH="${START_DIR}/isp-buster-installer"
PYTHON_FILE="${CLONE_DIR}/speedtest.py"
ISP_BUSTER_FILE="${CLONE_DIR}/isp-buster"
INSTALLER_FILE="${CLONE_DIR}/isp-buster-installer"
UNINSTALLER_FILE="${CLONE_DIR}/isp-buster-uninstaller"
AUTOINSTALLER_FILE="${CLONE_DIR}/isp-buster-autoinstaller"
CRON_FILE="${CLONE_DIR}/crontab"
TMP_CRON_FILE="${CLONE_DIR}/crontab_tmp"
NEW_CRON_FILE="${CLONE_DIR}/crontab.new"
BAK_CRON_FILE="${BAK_DIR}/crontab.bak"
LOGFILE="${LOGS_DIR}/isp-buster_installation_log.txt"
TMP_LOGFILE="/home/${USER}/isp-buster_tmp_installation_log.txt"
APT_LIST="/etc/apt/sources.list.d/speedtest.list"

# Logtype Declarations
LOGTYPE_INFO="INFO"
LOGTYPE_WARNING="WARNING"
LOGTYPE_ERROR="ERROR"

# Cronstring Declaration
CRON_STRING="*/30 * * * * /usr/bin/isp-buster"

# Git URL Declarations
GIT_ISPBUSTER="https://github.com/xXNightstalkerXx/isp-buster.git"

# Color Declarations
std=$(tput setaf 15)
red=$(tput setaf 9 bold)
green=$(tput setaf 10 bold)
# yellow=$(tput setaf 11 bold)
# pink=$(tput setaf 57)
blue=$(tput setaf 27 bold)

# Function Decalarations
write_logfile () {
    logtype="$1"
    logoutput="$3"
    logdescription="$2"
    date=$(date +"%d/%m/%y")
    timestamp=$(date +"%H:%M:%S")

    if ! [ -f "${LOGFILE}" ]
    then
        printf "[%s]  [%s]  [%s]  [%s]\n%s\n\n" "${date}" "${timestamp}" "${logtype}" "${logdescription}" "${logoutput}" > "${LOGFILE}"
    else
        printf "[%s]  [%s]  [%s]  [%s]\n%s\n\n" "${date}" "${timestamp}" "${logtype}" "${logdescription}" "${logoutput}" >> "${LOGFILE}"
    fi
}

write_tmp_logfile () {
    logtype="$1"
    logoutput="$3"
    logdescription="$2"
    date=$(date +"%d/%m/%y")
    timestamp=$(date +"%H:%M:%S")

    if ! [ -f "${TMP_LOGFILE}" ]
    then
        printf "[%s]  [%s]  [%s]  [%s]\n%s\n\n" "${date}" "${timestamp}" "${logtype}" "${logdescription}" "${logoutput}" > "${TMP_LOGFILE}"
    else
        printf "[%s]  [%s]  [%s]  [%s]\n%s\n\n" "${date}" "${timestamp}" "${logtype}" "${logdescription}" "${logoutput}" >> "${TMP_LOGFILE}"
    fi
}

# Main Script
echo ""
echo ""
echo "${blue} ___  ________  ________        ________  ___  ___  ________  _________  _______   ________${std}"
echo "${blue}|\  \|\   ____\|\   __  \      |\   __  \|\  \|\  \|\   ____\|\___   ___|\  ___ \ |\   __  \\${std}"
echo "${blue}\ \  \ \  \___|\ \  \|\  \     \ \  \|\ /\ \  \\\\\  \ \  \___|\|___ \  \_\ \   __/|\ \  \|\  \\${std}"
echo "${blue} \ \  \ \_____  \ \   ____\     \ \   __  \ \  \\\\\  \ \_____  \   \ \  \ \ \  \_|/_\ \   _  _\\${std}"
echo "${blue}  \ \  \|____|\  \ \  \___|      \ \  \|\  \ \  \\\\\  \|____|\  \   \ \  \ \ \  \_|\ \ \  \\\  \|${std}"
echo "${blue}   \ \__\____\_\  \ \__\          \ \_______\ \_______\____\_\  \   \ \__\ \ \_______\ \__\\\ _\\${std}"
echo "${blue}    \|__|\_________\|__|           \|_______|\|_______|\_________\   \|__|  \|_______|\|__|\|__|${std}"
echo "${blue}        \|_________|                                  \|_________|${std}"
echo "ISP Buster Speedtest Tool by Nightstalker"
echo ""
echo ""
LOGDESC="Checking OS"
echo "${blue}${LOGDESC}...${std}"
os_type="$(grep -E '^(NAME)=' /etc/os-release)"
os_type=${os_type#*=}

if [[ "$os_type" == *"Kali"* ]]
then
	INSTALL_OPTIONS=1
	echo ""
	echo "$os_type"
    LOGOUTPUT="${os_type}"
    write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
elif [[ "$os_type" == *"Raspbian"* ]]
then
	if [[ $(cat /boot/issue.txt) == *"stage2"* ]]
	then
		INSTALL_OPTIONS=2
		echo ""
		echo "$os_type"
        echo " Lite Version"
        LOGOUTPUT="${os_type} - Lite Version"
        write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
	elif [[ $(cat /boot/issue.txt) == *"stage4"* ]]
	then
		INSTALL_OPTIONS=3
		echo ""
		echo "$os_type"
		echo " GUI Lite Version"
        LOGOUTPUT="${os_type} - GUI Lite Version"
        write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
	elif [[ $(cat /boot/issue.txt) == *"stage5"* ]]
	then
		INSTALL_OPTIONS=3
		echo ""
		echo "$os_type"
		echo " GUI Full Version"
        LOGOUTPUT="${os_type} - GUI Full Version"
        write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
	else
		INSTALL_OPTIONS=2
		echo ""
		echo "$os_type"
		echo " Unknown Raspbian"
		echo " Using Lite Version Install Options!"
        LOGOUTPUT="${os_type} - Unknown Raspbian"
        write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
	fi
else
	echo ""
    LOGOUTPUT="Wrong Operating System detected! Aborting the Installation!"
	echo "${red}${LOGOUTPUT}${std}"
    write_tmp_logfile "${LOGTYPE_ERROR}" "${LOGDESC}" "${LOGOUTPUT}"
	sleep 1
	exit 1
fi

echo ""
sleep 0.5
LOGOUTPUT="Operating System okay! Continuing the Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Updating Repository List"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT=$(sudo apt-get update)
echo "${LOGOUTPUT}"
write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT="Repository List updated! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Update OS"
echo "${green}It is highly recommended to update your OS before Installation!${std}"
echo "${green}Do you want to update your OS?${std}"
read -r -p "Yes (y)/ No (n): " n;

while ! [[ "$n" =~ ^(y|n)$ ]];
do
	echo ""
	echo "${red}Wrong Input! Please type 'y' for 'YES' or 'n' for 'NO'!${std}"
	read -r -p "Yes (y)/ No (n): " n;
done

if [[ "$n" =~ ^(y)$ ]];
then
	echo ""
    LOGOUTPUT="Updating the OS now"
	echo "${blue}${LOGDESC}...${std}"
    write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
	echo ""
	LOGOUTPUT=$(sudo apt-get upgrade -y)
    echo "${LOGOUTPUT}"
    write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
	echo ""
    sleep 0.5
    LOGOUTPUT="Operating System updated successfully! Continuing the Installation!"
	echo "${blue}${LOGOUTPUT}${std}"
    write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
	sleep 1
else
	echo ""
    LOGOUTPUT="Not updating your OS! Installation might fail!"
	echo "${red}${LOGOUTPUT}${std}"
    write_tmp_logfile "${LOGTYPE_WARNING}" "${LOGDESC}" "${LOGOUTPUT}"
	sleep 1
fi

echo ""
echo ""
LOGDESC="Checking Directories"
echo "${blue}${LOGDESC}...${std}"
echo ""

LOGOUTPUT="Checking ${INSTALL_DIR} Directory"
echo "${blue}${LOGOUTPUT}...${std}"
write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"

if [ -d "${INSTALL_DIR}" ]
then
    sleep 0.5
    LOGOUTPUT="${INSTALL_DIR} Directory exists. Not Creating this Directory!"
	echo "${green}${LOGOUTPUT}${std}"
    write_tmp_logfile "${LOGTYPE_WARNING}" "${LOGDESC}" "${LOGOUTPUT}"
else
    sleep 0.5
    LOGOUTPUT="${INSTALL_DIR} Directory doesn't exist. Creating the Directory!"
	echo "${blue}${LOGOUTPUT}${std}"
	sudo mkdir -p "${INSTALL_DIR}"
    write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
fi

sleep 0.5
LOGOUTPUT="Checking ${RESULTS_DIR} Directory"
echo "${blue}${LOGOUTPUT}...${std}"
write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"

if [ -d "${RESULTS_DIR}" ]
then
	sleep 0.5
    LOGOUTPUT="${RESULTS_DIR} Directory exists. Not Creating this Directory!"
	echo "${green}${LOGOUTPUT}${std}"
    write_tmp_logfile "${LOGTYPE_WARNING}" "${LOGDESC}" "${LOGOUTPUT}"
else
    sleep 0.5
    LOGOUTPUT="${RESULTS_DIR} Directory doesn't exist. Creating the Directory!"
	echo "${blue}${LOGOUTPUT}${std}"
	sudo mkdir -p "${RESULTS_DIR}"
    write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
fi

sleep 0.5
LOGOUTPUT="Checking ${LOGS_DIR} Directory"
echo "${blue}${LOGOUTPUT}...${std}"
write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"

if [ -d "${LOGS_DIR}" ]
then
	sleep 0.5
    LOGOUTPUT="${LOGS_DIR} Directory exists. Not Creating this Directory!"
	echo "${green}${LOGOUTPUT}${std}"
    write_tmp_logfile "${LOGTYPE_WARNING}" "${LOGDESC}" "${LOGOUTPUT}"
else
	sleep 0.5
    LOGOUTPUT="${LOGS_DIR} Directory doesn't exist. Creating the Directory!"
	echo "${blue}${LOGOUTPUT}${std}"
	sudo mkdir -p "${LOGS_DIR}"
    write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
fi

sleep 0.5
LOGOUTPUT="Checking ${BAK_DIR} Directory"
echo "${blue}${LOGOUTPUT}...${std}"
write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"

if [ -d "${BAK_DIR}" ]
then
	sleep 0.5
    LOGOUTPUT="${BAK_DIR} Directory exists. Not Creating this Directory!"
	echo "${green}${LOGOUTPUT}${std}"
    write_tmp_logfile "${LOGTYPE_WARNING}" "${LOGDESC}" "${LOGOUTPUT}"
else
	sleep 0.5
    LOGOUTPUT="${BAK_DIR} Directory doesn't exist. Creating the Directory!"
	echo "${blue}${LOGOUTPUT}${std}"
	sudo mkdir -p "${BAK_DIR}"
    write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
fi

sleep 0.5
echo ""
LOGOUTPUT="Directories are okay! Continuing the Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Moving Temporary Logfile"
LOGOUTPUT="Moving temporary Logfile to ${LOGS_DIR}"
echo "${blue}${LOGOUTPUT}...${std}"
write_tmp_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sudo mv "${TMP_LOGFILE}" "${LOGFILE}"
sleep 0.5
LOGOUTPUT="Logfile moved successfully! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Installing Git"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT="Checking if Git is already installed"
echo "${blue}${LOGOUTPUT}...${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"

if hash git 2>/dev/null
then
    sleep 0.5
    LOGOUTPUT="Git is already installed!"
	echo "${blue}${LOGOUTPUT}${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
else
    sleep 0.5
    LOGOUTPUT="Git is not installed. Installing Git now!"
	echo "${red}${LOGOUTPUT}${std}"
    write_logfile "${LOGTYPE_WARNING}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
	LOGOUTPUT=$(sudo apt-get install git -y)
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
fi

sleep 0.5
echo ""
LOGOUTPUT="Git is installed and okay! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Installing Utilities"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT=$(sudo apt-get install -y apt-transport-https gnupg1 dirmngr lsb-release)
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT="Utilities installed successfully! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Installing Ookla Repository Key"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT=$(curl -L https://packagecloud.io/ookla/speedtest-cli/gpgkey | gpg --dearmor | sudo tee /usr/share/keyrings/speedtestcli-archive-keyring.gpg 1> /dev/null)
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_WARNING}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT="Ookla Repository Key installed successfully! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Adding Ookla Repository to APT Repository Lists"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT=$(echo "deb [signed-by=/usr/share/keyrings/speedtestcli-archive-keyring.gpg] https://packagecloud.io/ookla/speedtest-cli/debian/ $(lsb_release -cs) main" | sudo tee ${APT_LIST} 1> /dev/null)
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_WARNING}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT="Ookla Repository successfully added to APT Repository Lists! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Updating Repository List again"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT=$(sudo apt-get update)
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT="Repository List updated! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Installing the Speedtest Binary"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT=$(sudo apt-get install -y speedtest)
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT="Speedtest Binaries installed successfully! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Launching the initial Speedtest"
echo "${blue}${LOGDESC}...${std}"
LOGOUTPUT=$(sudo speedtest --accept-license --accept-gdpr 2>&1)
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT="Speedtest tested successfully! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Downloading ISP-Buster Github Repository"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT="Changing Directory to ${INSTALL_DIR}"
echo "${blue}${LOGOUTPUT}...${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT=$(cd "${INSTALL_DIR}" 2>&1)
echo "cd ${INSTALL_DIR}; ${LOGOUTPUT}"
cd "${INSTALL_DIR}" &> /dev/null
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT="Downloading Repository now"
echo "${blue}${LOGOUTPUT}...${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT=$(sudo git clone ${GIT_ISPBUSTER} 2>&1)
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT="Repository successfully downloaded! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Making Scripts executable"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT=$(sudo chmod 0755 ${PYTHON_FILE})
LOGOUTPUT="sudo chmod 0755 ${PYTHON_FILE}; ${LOGOUTPUT}"
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 0.5
LOGOUTPUT=$(sudo chmod 0755 ${ISP_BUSTER_FILE})
LOGOUTPUT="sudo chmod 0755 ${ISP_BUSTER_FILE}; ${LOGOUTPUT}"
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 0.5
LOGOUTPUT=$(sudo chmod 0755 ${INSTALLER_FILE})
LOGOUTPUT="sudo chmod 0755 ${INSTALLER_FILE}; ${LOGOUTPUT}"
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 0.5
LOGOUTPUT=$(sudo chmod 0755 ${UNINSTALLER_FILE})
LOGOUTPUT="sudo chmod 0755 ${UNINSTALLER_FILE}; ${LOGOUTPUT}"
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 0.5
LOGOUTPUT=$(sudo chmod 0755 ${AUTOINSTALLER_FILE})
LOGOUTPUT="sudo chmod 0755 ${AUTOINSTALLER_FILE}; ${LOGOUTPUT}"
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT="Successfully made Scripts executable! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Copying Scripts to ${SCRIPTS_DIR}"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT=$(sudo cp ${ISP_BUSTER_FILE} ${SCRIPTS_DIR})
LOGOUTPUT="sudo cp ${ISP_BUSTER_FILE} ${SCRIPTS_DIR}; ${LOGOUTPUT}"
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 0.5
LOGOUTPUT=$(sudo cp ${UNINSTALLER_FILE} ${SCRIPTS_DIR})
LOGOUTPUT="sudo cp ${UNINSTALLER_FILE} ${SCRIPTS_DIR}; ${LOGOUTPUT}"
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT="Successfully copied Scripts to ${SCRIPTS_DIR}! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Setting up IPerf3"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT="Do you have an IPerf3 Host on your Firewall?"
echo "${green}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
echo "1. Switch on IPerf3 Network testing"
echo "2. Don't use IPerf3"
echo ""
read -r -p "${green}Enter a Number for an Option: ${std}" n;
while ! [[ $n =~ ^[1-2]$ ]]
do
    echo ""
    echo "${red}Wrong Input! Please enter a Number for an Option!${std}"
    read -r -p "Enter a Number for an Option: " n;
done
sleep 0.5
if [[ "$n" =~ ^(1)$ ]];
then
    echo ""
    LOGOUTPUT="Select IPerf3 Host IPv4"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
	read -r -p "${green}Enter the IPv4 of the IPerf Host: ${std}" ip_address;
	echo "${blue}Checking if the Host is reachable...${std}"
	if ping -c 1 "$ip_address" &> /dev/null
	then
        LOGOUTPUT="The Host is reachable!"
		echo "${blue}${LOGOUTPUT}${std}"
        write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
        sleep 0.5
		i=1
	else
		i=0
	fi
	while [[ $i -eq 0 ]]
	do
		echo ""
        LOGOUTPUT="The Host is not reachable! Please try a different IP!"
		echo "${red}${LOGOUTPUT}${std}"
        write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
        sleep 0.5
		read -r -p "Enter the IP of the NAS Server: " ip_address;
		echo ""
		echo "${blue}Checking if the Host is reachable...${std}"

		if ping -c 1 "$ip_address" &> /dev/null
		then
			LOGOUTPUT="The Host is reachable!"
            echo "${blue}${LOGOUTPUT}${std}"
            write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
            sleep 0.5
			i=1
		else
			i=0
		fi
	done
    echo ""
    LOGOUTPUT="Changing IPerf3 to ON and Host IPv4 within ${PYTHON_FILE}"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT=$(sudo sed -i "s/^iperf = */iperf = True/" ${PYTHON_FILE} 2>&1)
    LOGOUTPUT="sudo sed -i 's/^iperf = */iperf = True/' ${PYTHON_FILE}; ${LOGOUTPUT}"
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT=$(sudo sed -i "s/^target_ip = */target_ip = ${ip_address}/" ${PYTHON_FILE} 2>&1)
    LOGOUTPUT="sudo sed -i 's/^target_ip = */target_ip = ${ip_address}/' ${PYTHON_FILE}; ${LOGOUTPUT}"
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
else
    LOGOUTPUT="Not switching ON IPerf3!"
    echo "${blue}${LOGOUTPUT}${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
fi
LOGOUTPUT="IPerf3 successfully set up! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Setting up Server ID"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT="Do you want to change the Server ID to a specific one?"
echo "${green}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
echo "1. Change the Server ID"
echo "2. Choose Best at Runtime"
echo ""
read -r -p "${green}Enter a Number for an Option: ${std}" n;
while ! [[ $n =~ ^[1-2]$ ]]
do
    echo ""
    echo "${red}Wrong Input! Please enter a Number for an Option!${std}"
    read -r -p "Enter a Number for an Option: " n;
done
sleep 0.5
if [[ "$n" =~ ^(1)$ ]];
then
    echo ""
    LOGDESC="Select Server ID"
    echo "${blue}${LOGDESC}...${std}"
    echo ""
    LOGOUTPUT="Searching for Servers to display"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    RESULTS=$(speedtest -L)
    LOGOUTPUT=$(printf "%s   %s   %s\n" "Number" "Server ID" "Server Name")
    COUNTER=1
    IFS=$'\n'
    for LINE in ${RESULTS}; do
        if [[ ${LINE} =~ ^[[:space:]]*([0-9]+)[[:space:]]+([[:alnum:][:space:]-]+)$ ]]; then
            SERVER_ID=${BASH_REMATCH[1]}
            SERVER_NAME=${BASH_REMATCH[2]}
            SERVER_NAME=$(echo "$SERVER_NAME" | sed -E 's/^(.*?)[[:space:]]{2,}.*$/\1/')
            SERVER_NAME=$(echo "$SERVER_NAME" | sed -E 's/[[:space:]]+[[:alpha:]]+[[:space:]]*$//')
            FORMATTED_LINE=$(printf "%3s   %12s   %s\n" "$COUNTER." "$SERVER_ID" "$SERVER_NAME")
            LOGOUTPUT="${LOGOUTPUT}${FORMATTED_LINE}"
            SERVER_IDS[COUNTER]=$SERVER_ID
            ((COUNTER++))
        fi
    done
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    read -r -p "${green}Enter a Number for the Server ID you want to test against:${std} " n;
    while ! [[ $n =~ ^[1-9][0-9]{0,2}$ && $n -le ${#SERVER_IDS[@]} ]]
    do
            echo ""
            echo "${red}Wrong Input! Please enter a Number for the Server ID!${std}"
            read -r -p "Enter a Number for the Server ID: " n;
    done
    SERVER_ID="${SERVER_IDS[$n]}"
    echo ""
    LINE="You selected the following Server ID:"
    echo "${green}${LINE}${std}"
    echo "$SERVER_ID"
    FORMATTED_LINE=$(printf "%s\n" "${LINE}")
    LOGOUTPUT="${FORMATTED_LINE}${SERVER_ID}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT="Changing Server ID within ${PYTHON_FILE}"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT=$(sudo sed -i "s/^target_id = */target_id = ${SERVER_ID}/" ${PYTHON_FILE} 2>&1)
    LOGOUTPUT="sudo sed -i 's/^target_id = */target_id = ${SERVER_ID}/' ${PYTHON_FILE}; ${LOGOUTPUT}"
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
else
    LOGOUTPUT="Not changing Server ID within ${PYTHON_FILE}!"
    echo "${blue}${LOGOUTPUT}${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
fi
LOGOUTPUT="Server ID successfully set up! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Setting up Crontab"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT="Checking if there already is a Crontab"
echo "${blue}${LOGOUTPUT}...${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
LOGOUTPUT=$(sudo crontab -u root -l 2>&1)
echo "${LOGOUTPUT}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
if [[ "${LOGOUTPUT}" = "no crontab for root" ]]
then
    LOGOUTPUT="There's no Crontab! Creating one now!"
    echo "${blue}${LOGOUTPUT}${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT=$(sudo crontab -u root "${CRON_FILE}" 2>&1)
    LOGOUTPUT="sudo crontab -u root ${CRON_FILE}; ${LOGOUTPUT}"
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT="Copying a fresh Crontab File into the Backup Directory"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT=$(sudo cp "${NEW_CRON_FILE}" "${BAK_CRON_FILE}" 2>&1)
    LOGOUTPUT="sudo cp ${NEW_CRON_FILE} ${BAK_CRON_FILE}; ${LOGOUTPUT}"
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
else
    LOGOUTPUT="Creating a backup of the Crontab now"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT=$(sudo crontab -u root -l | sudo tee "${BAK_CRON_FILE}" 2>&1)
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT="Copying backup File"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT=$(sudo cp ${BAK_CRON_FILE} ${TMP_CRON_FILE} 2>&1)
    LOGOUTPUT="sudo cp ${BAK_CRON_FILE} ${TMP_CRON_FILE}; ${LOGOUTPUT}"
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT="Inserting Cronjob into File"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT=$(echo "${CRON_STRING}" | sudo tee -a ${TMP_CRON_FILE} 2>&1)
    LOGOUTPUT="echo '${CRON_STRING}' | sudo tee -a ${TMP_CRON_FILE}; ${LOGOUTPUT}"
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT="Updating crontab with the File"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT=$(sudo crontab -u root "${TMP_CRON_FILE}" 2>&1)
    LOGOUTPUT="sudo crontab -u root ${TMP_CRON_FILE}; ${LOGOUTPUT}"
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT="Removing Temporary File"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
    LOGOUTPUT=$(sudo rm "${TMP_CRON_FILE}" 2>&1)
    LOGOUTPUT="sudo rm ${TMP_CRON_FILE}; ${LOGOUTPUT}"
    echo "${LOGOUTPUT}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
fi
LOGOUTPUT="Successfully created Cronjob! Continuing Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Cleaning up the Installation"
echo "${blue}${LOGDESC}...${std}"
echo ""
LOGOUTPUT="Checking if I exist in the Directory I'm run"
echo "${blue}${LOGOUTPUT}...${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
echo ""
sleep 0.5
if [ -f "${MY_PATH}" ]
then
    LOGOUTPUT="It seems I still exist. Purging myself now for Cleanup"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
	i_exist=true
else
    LOGOUTPUT="It seems I don't exist in the Directory I'm run. Not able to clean myself up!"
    echo "${red}${LOGOUTPUT}${std}"
    write_logfile "${LOGTYPE_WARNING}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
	i_exist=false
fi

echo ""
LOGOUTPUT="Cleanup complete! Continuing the Installation!"
echo "${blue}${LOGOUTPUT}${std}"
write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
sleep 1

echo ""
echo ""
LOGDESC="Rebooting after Installation"
echo "${blue}${LOGDESC}...${std}"
echo ""
echo "${green}It is highly recommended to reboot after Installation!${std}"
echo "${green}Do you want to reboot now?${std}"
read -r -p "Yes (y)/ No (n): " n;

while ! [[ "$n" =~ ^(y|n)$ ]];
do
	echo ""
	echo "${red}Wrong Input! Please type 'y' for 'YES' or 'n' for 'NO'!${std}"
	read -r -p "Yes (y)/ No (n): " n;
done

if [[ "$n" =~ ^(y)$ ]];
then
	echo ""
    LOGOUTPUT="Installation complete! Rebooting now"
    echo "${blue}${LOGOUTPUT}...${std}"
    write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
    echo ""
    sleep 0.5
	if $i_exist
	then
		LOGOUTPUT=$(sudo rm "${MY_PATH}")
        LOGOUTPUT="sudo rm ${MY_PATH}; ${LOGOUTPUT}"
        write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
        sleep 0.5
	fi
	sudo reboot now
	sleep 1
else
	echo ""
    LOGOUTPUT="Installation complete! Not Rebooting!"
    echo "${red}${LOGOUTPUT}${std}"
    echo "${red}Please reboot your System whenever it is convenient!${std}"
    write_logfile "${LOGTYPE_WARNING}" "${LOGDESC}" "${LOGOUTPUT}"
    sleep 0.5
	if $i_exist
	then
        LOGOUTPUT=$(sudo rm "${MY_PATH}")
        LOGOUTPUT="sudo rm ${MY_PATH}; ${LOGOUTPUT}"
        write_logfile "${LOGTYPE_INFO}" "${LOGDESC}" "${LOGOUTPUT}"
        sleep 0.5
	fi
	sleep 1
fi